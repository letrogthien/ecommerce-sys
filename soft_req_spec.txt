# ĐẶC TẢ YÊU CẦU PHẦN MỀM HỆ THỐNG E-COMMERCE

## 1. Giới thiệu

Tài liệu này mô tả chi tiết các yêu cầu nghiệp vụ, chức năng và phi chức năng của hệ thống thương mại điện tử đa dịch vụ. Mục tiêu của tài liệu là cung cấp một cái nhìn toàn diện về kiến trúc, các phân hệ, quy trình nghiệp vụ, luồng sự kiện, các thực thể, tác nhân và các use-case tiêu biểu của hệ thống. Tài liệu được trình bày theo chuẩn chuyên nghiệp, dễ dàng sử dụng cho các bên liên quan như kiến trúc sư hệ thống, lập trình viên, kiểm thử viên, và quản trị viên dự án. Nội dung tài liệu giúp đảm bảo quá trình phát triển, triển khai và vận hành hệ thống được nhất quán, hiệu quả, bảo mật và dễ mở rộng.

## 1.1 Mục tiêu

- Đảm bảo hệ thống đáp ứng đầy đủ các nghiệp vụ mua bán, quản lý, thanh toán, phân tích và thông báo realtime.
- Hỗ trợ khả năng mở rộng, tích hợp linh hoạt với các dịch vụ khác.
- Đảm bảo tính bảo mật, hiệu năng cao, và khả năng xử lý bất đồng bộ qua Kafka.
- Là cơ sở để phát triển, kiểm thử, triển khai và vận hành hệ thống nhất quán, hiệu quả.
- Là tài liệu tham khảo cho các bên liên quan: kiến trúc sư, lập trình viên, kiểm thử viên, quản trị viên dự án.

## 1.2 Phạm vi

- Tài liệu này áp dụng cho toàn bộ hệ thống thương mại điện tử đa dịch vụ, bao gồm các phân hệ: Người dùng (User), Quản trị hệ thống (Admin), Sản phẩm & Danh mục (Product), Đơn hàng & Hoàn tiền (Transaction), Ví & Thanh toán (Wallet), Thông báo realtime (Notify), Phân tích thống kê (Analytics).
- Đặc tả đầy đủ các yêu cầu chức năng, phi chức năng, các quy trình nghiệp vụ, luồng sự kiện, thực thể, tác nhân, use-case và các ràng buộc kỹ thuật liên quan đến quá trình phát triển, triển khai và vận hành hệ thống.
- Là cơ sở để thiết kế kiến trúc, phát triển phần mềm, kiểm thử, vận hành và bảo trì hệ thống.
- Đối tượng sử dụng: kiến trúc sư hệ thống, lập trình viên, kiểm thử viên, quản trị viên dự án và các bên liên quan khác.

## 2. Đặc tả hệ thống
### 2.0 Công nghệ và Kiến trúc

**Kiến trúc hệ thống:**
Hệ thống được xây dựng theo mô hình microservices, mỗi phân hệ là một dịch vụ độc lập, giao tiếp qua event Kafka và REST API. Các dịch vụ được triển khai trên nền tảng Spring Boot, sử dụng MongoDB cho lưu trữ dữ liệu, Redis cho cache và quản lý phiên, bảo mật bằng JWT, phân quyền theo vai trò (Role-based Access Control).

**Các công nghệ sử dụng:**

**Mô hình triển khai hệ thống:**

Hệ thống e-commerce đa dịch vụ được thiết kế linh hoạt, hỗ trợ nhiều mô hình cài đặt và triển khai:
- **Triển khai độc lập từng dịch vụ (Microservices):**
	- Mỗi phân hệ (User, Product, Transaction, Wallet, Notify, Analytics) là một service độc lập, đóng gói riêng biệt (jar, docker image).
	- Có thể triển khai trên nhiều máy chủ vật lý, máy ảo, hoặc container (Docker, Kubernetes).
	- Giao tiếp giữa các service qua Kafka (event-driven) và REST API (synchronous).
- **Triển khai trên Cloud hoặc On-Premise:**
	- Hỗ trợ triển khai trên các nền tảng cloud phổ biến (AWS, Azure, GCP) hoặc hệ thống nội bộ (on-premise).
	- Sử dụng các dịch vụ cloud như managed Kafka, managed MongoDB, Redis, object storage, email service.
	- Tích hợp các cổng thanh toán qua API, bảo mật kết nối bằng SSL/TLS.
- **Quản lý cấu hình và bảo trì:**
	- Sử dụng file cấu hình (application.properties/yaml) cho từng service, hỗ trợ biến môi trường khi deploy.
	- Hỗ trợ hot-reload cấu hình, tự động scale khi có nhu cầu tăng tải.
	- Tích hợp giám sát (Prometheus, Grafana), logging tập trung (ELK, Loki), cảnh báo (Alertmanager).
- **CI/CD và DevOps:**
	- Hỗ trợ pipeline CI/CD tự động (Jenkins, GitHub Actions, GitLab CI) để build, test, deploy từng service.
	- Quản lý version, rollback, audit log khi deploy.
	- Tích hợp kiểm thử tự động, kiểm tra bảo mật, kiểm tra hiệu năng trước khi release.

**Tóm tắt mô hình cài đặt:**

- Mỗi service có thể triển khai độc lập hoặc theo cụm (cluster), đảm bảo HA (High Availability), DR (Disaster Recovery).
- Hệ thống hỗ trợ scale ngang, tự động mở rộng khi tải tăng.
- Quản lý trạng thái, log, audit, backup dữ liệu định kỳ.
- JWT: xác thực, phân quyền, bảo mật API, quản lý phiên làm việc.
- WebSocket: gửi thông báo realtime, cập nhật trạng thái đơn hàng, thanh toán, cảnh báo bảo mật.
**Mô hình triển khai:**
- Các dịch vụ được đóng gói độc lập, có thể triển khai trên cloud hoặc on-premise.
- Giao tiếp giữa các dịch vụ qua Kafka (event-driven) và REST API (synchronous).
- Tích hợp các cổng thanh toán (VNPAY, ngân hàng) qua API.
- Hệ thống hỗ trợ mở rộng, tích hợp thêm dịch vụ mới dễ dàng.

**Đảm bảo:**
- Bảo mật, hiệu năng, khả năng mở rộng, tính nhất quán dữ liệu, xử lý realtime và bất đồng bộ.
- Hỗ trợ audit, logging, giám sát, cảnh báo, báo cáo thống kê.

### 2.1 Giới thiệu chung về hệ thống
Hệ thống thương mại điện tử đa dịch vụ được xây dựng theo kiến trúc microservices, sử dụng Spring Boot, Kafka, MongoDB, Redis, REST API, bảo mật JWT, phân quyền theo vai trò. Các dịch vụ hoạt động độc lập, giao tiếp qua event Kafka, đảm bảo khả năng mở rộng, tính nhất quán dữ liệu và hiệu năng cao.

Các phân hệ chính:
- Người dùng (User): Đăng ký, đăng nhập, quản lý thông tin, xác thực, preference, địa chỉ, KYC
- Quản trị hệ thống (Admin): Quản lý user, vai trò, trạng thái, audit, duyệt seller
- Sản phẩm & Danh mục (Product): Quản lý sản phẩm, danh mục, biến thể, ảnh, tìm kiếm, bộ lọc
- Đơn hàng & Hoàn tiền (Transaction): Tạo/xem/hủy đơn, upload bằng chứng, khiếu nại, hoàn tiền
- Ví & Thanh toán (Wallet): Quản lý ví, giao dịch, rút tiền, nạp tiền, thống kê, nghi ngờ, callback
- Thông báo realtime (Notify): Email xác thực, OTP, cảnh báo, socket realtime
- Phân tích thống kê (Analytics): Dashboard, biểu đồ, top sản phẩm, khách hàng, hiệu suất

Hệ thống đảm bảo các yêu cầu về bảo mật, hiệu năng, khả năng tích hợp, mở rộng và xử lý bất đồng bộ qua Kafka.

### 2.1.1 Phân hệ Người dùng (User)
- Quản lý hồ sơ cá nhân: cập nhật thông tin, avatar, địa chỉ thanh toán
- Quản lý tuỳ chọn cá nhân (preference, settings)
- Quản lý bảo mật: xác thực 2FA, OTP, đăng xuất phiên, refresh token
- Quản lý trạng thái tài khoản, xác thực KYC
- Đăng ký trở thành người bán (seller application)
- Đánh giá người bán, phản hồi chất lượng sản phẩm/dịch vụ
- Xem lịch sử giao dịch, đơn hàng, trạng thái giao dịch

Các chức năng này đảm bảo người dùng có thể thao tác đầy đủ trên hệ thống, bảo mật thông tin cá nhân, thuận tiện trong quá trình mua bán và sử dụng dịch vụ.

### 2.1.2 Phân hệ Sản phẩm & Danh mục (Product)

Phân hệ Sản phẩm & Danh mục cung cấp các chức năng quản lý toàn diện về sản phẩm số, danh mục, biến thể và hình ảnh sản phẩm:

- Tạo mới, cập nhật, xoá sản phẩm số (game key, gift card, tài khoản dịch vụ, phần mềm bản quyền...)
- Quản lý thông tin chi tiết sản phẩm: mô tả, giá bán, tồn kho, thuộc tính riêng (region lock, thời hạn sử dụng...)
- Quản lý danh mục sản phẩm: tạo, sửa, xoá, phân loại, hỗ trợ tìm kiếm và lọc sản phẩm
- Quản lý biến thể sản phẩm: thêm, sửa, xoá, liệt kê các biến thể (ví dụ: loại key, thời hạn, khu vực...)
- Quản lý hình ảnh sản phẩm: upload, cập nhật, xoá hình ảnh minh hoạ
- Tìm kiếm sản phẩm: hỗ trợ tìm kiếm nhanh theo tên, mã sản phẩm, hoặc lọc nâng cao theo giá, loại, người bán, đánh giá
- Gợi ý từ khoá, bộ lọc sản phẩm theo xu hướng, đánh giá, doanh số
- Quản lý trạng thái sản phẩm: hết hàng, tạm dừng bán, hết hạn

Các chức năng này giúp người bán quản lý kho hàng hiệu quả, người mua dễ dàng tìm kiếm và lựa chọn sản phẩm phù hợp, đồng thời hỗ trợ admin kiểm duyệt, phân loại và giám sát chất lượng sản phẩm trên hệ thống.

### 2.1.3 Phân hệ Đơn hàng & Hoàn tiền (Transaction)

Phân hệ Đơn hàng & Hoàn tiền chịu trách nhiệm quản lý toàn bộ quy trình đặt hàng, xử lý giao dịch, khiếu nại và hoàn tiền:

- Tạo đơn hàng mới, xác nhận thông tin đặt hàng
- Xem chi tiết đơn hàng, lịch sử giao dịch, trạng thái đơn hàng (pending, paid, delivered, completed, refunded)
- Huỷ đơn hàng, cập nhật trạng thái đơn hàng
- Upload bằng chứng giao hàng, xác nhận giao dịch
- Quản lý khiếu nại: mở khiếu nại, cập nhật, theo dõi trạng thái xử lý
- Quản lý yêu cầu hoàn tiền: gửi yêu cầu, kiểm tra trạng thái, xử lý hoàn tiền
- Tích hợp luồng event Kafka: sinh event khi tạo/hủy đơn, xử lý event xác nhận sản phẩm, thanh toán, hoàn tiền
- Tương tác với các phân hệ khác: ví điện tử, sản phẩm, thông báo realtime

Các chức năng này đảm bảo quy trình giao dịch minh bạch, bảo vệ quyền lợi người mua/người bán, hỗ trợ xử lý tranh chấp và hoàn tiền nhanh chóng, đồng thời giúp hệ thống kiểm soát, giám sát toàn bộ luồng nghiệp vụ liên quan đến đơn hàng.

### 2.1.4 Phân hệ Ví & Thanh toán (Wallet)

Phân hệ Ví & Thanh toán chịu trách nhiệm quản lý các hoạt động liên quan đến ví điện tử, giao dịch thanh toán, nạp/rút tiền và kiểm soát tài chính:

- Tạo ví điện tử tự động khi người dùng đăng ký tài khoản
- Quản lý số dư ví, lịch sử giao dịch, trạng thái ví
- Nạp tiền vào ví qua các cổng thanh toán (VNPAY, ngân hàng, thẻ...)
- Thực hiện thanh toán đơn hàng bằng ví, kiểm tra trạng thái giao dịch
- Rút tiền từ ví về tài khoản ngân hàng liên kết
- Quản lý tài khoản ngân hàng liên kết, xác thực thông tin rút tiền
- Duyệt/từ chối yêu cầu rút tiền, kiểm tra giao dịch nghi ngờ
- Thống kê ví, giao dịch, doanh thu, lịch sử nạp/rút
- Tích hợp event Kafka: sinh event khi nạp/rút tiền, thanh toán, callback trạng thái giao dịch
- Tương tác với các phân hệ khác: đơn hàng, sản phẩm, thông báo realtime

Các chức năng này đảm bảo việc quản lý tài chính minh bạch, bảo mật, thuận tiện cho người dùng và người bán, đồng thời hỗ trợ admin kiểm soát, giám sát các hoạt động thanh toán trên hệ thống.

### 2.1.5 Phân hệ Thông báo realtime (Notify)

Phân hệ Thông báo realtime chịu trách nhiệm gửi các thông báo, cảnh báo, xác thực và cập nhật trạng thái tới người dùng, người bán và admin qua nhiều kênh:

- Gửi email xác thực đăng ký, reset mật khẩu, OTP, cảnh báo bảo mật
- Gửi OTP 2FA qua email hoặc các kênh xác thực khác
- Gửi cảnh báo khi phát hiện đăng nhập từ thiết bị lạ hoặc hành vi bất thường
- Gửi thông báo realtime qua WebSocket khi có sự kiện thanh toán, đơn hàng, đăng ký, đổi mật khẩu
- Quản lý trung tâm thông báo: lưu trữ, hiển thị, đánh dấu đã đọc
- Tích hợp event Kafka: nhận event từ các phân hệ khác để sinh thông báo realtime
- Hỗ trợ gửi thông báo tới admin khi có sự kiện quan trọng (giao dịch lớn, khiếu nại, nghi ngờ gian lận...)
- Tương tác với các phân hệ: đơn hàng, ví, sản phẩm, người dùng

Các chức năng này giúp hệ thống đảm bảo thông tin kịp thời, tăng trải nghiệm người dùng, hỗ trợ bảo mật và giám sát hoạt động toàn hệ thống.

### 2.1.6 Phân hệ Phân tích thống kê (Analytics)

Phân hệ Phân tích thống kê cung cấp các chức năng tổng hợp, phân tích và trực quan hóa dữ liệu hoạt động của hệ thống:

- Dashboard tổng quan: hiển thị các chỉ số chính về doanh thu, số lượng giao dịch, sản phẩm bán chạy, khách hàng tiềm năng
- Biểu đồ thống kê: doanh thu theo thời gian, số lượng đơn hàng, tỷ lệ hoàn tiền, xu hướng mua sắm
- Thống kê top sản phẩm, top khách hàng, top seller, sản phẩm bán chạy theo từng danh mục
- Phân tích hiệu suất hệ thống, phát hiện điểm nghẽn, cảnh báo bất thường
- Báo cáo chi tiết cho admin: xuất file, lọc theo thời gian, danh mục, trạng thái
- Tích hợp dữ liệu từ các phân hệ: đơn hàng, sản phẩm, ví, người dùng
- Tương tác với các phân hệ khác để cập nhật realtime số liệu

Các chức năng này giúp admin, quản trị viên và người bán nắm bắt nhanh tình hình kinh doanh, tối ưu chiến lược, nâng cao hiệu quả vận hành và chất lượng dịch vụ.
## 2.2 Một số ký hiệu và định nghĩa
### 2.2.1 Một số ký hiệu

|-----|-----------------|------------------------------------------------------------------------|
| 1   | A-xx            | Ký hiệu tác nhân (Actor). xx → số thứ tự của tác nhân.                  |
| 2   | UCxx-yyz        | Ký hiệu use-case. xx → số thứ tự của phân hệ {0: Guest, 1: Người mua, 2: Người bán, 3: Quản trị viên}, yy → số thứ tự chức năng trong phân hệ, z → số thứ tự của use case trong chức năng yy |
| 3   | MHxx-yy         | Ký hiệu màn hình. xx → số thứ tự phân hệ, yy → số thứ tự màn hình trong phân hệ đó |
| 7   | MH03-00         | Trang chủ của phân hệ Quản trị viên                                     |
| 8   | DTO             | Data Transfer Object (đối tượng truyền dữ liệu qua API)                  |
| 12  | Event           | Sự kiện (ORDER_CREATED, PAYMENT_SUCCESS, ...)                           |


### 2.2.2 Định nghĩa tác nhân

**A-01 Người dùng (User)**
Là bất kỳ ai sử dụng hệ thống, bao gồm cả Guest, Người mua (Buyer), và Người bán (Seller). Người dùng có thể duyệt web, tìm kiếm sản phẩm, tham khảo thông tin, nhận thông báo, và thực hiện các thao tác phù hợp với vai trò của mình.

**A-02 Guest (Khách vãng lai)**
Là người dùng chưa có tài khoản hoặc chưa đăng nhập vào hệ thống.
	- Có thể xem thông tin sản phẩm, tìm kiếm, đọc mô tả, đánh giá sản phẩm và seller.
	- Không thể thực hiện giao dịch mua bán, không có quyền truy cập các chức năng quản lý cá nhân, ví, đơn hàng.

**A-03 Buyer (Người mua)**
Là người dùng đã đăng ký tài khoản và đăng nhập vào hệ thống với vai trò người mua.
	- Có thể thực hiện giao dịch mua hàng, quản lý đơn hàng, ví điện tử, thông tin cá nhân, nhận thông báo, đánh giá sản phẩm và seller.
	- Có quyền truy cập các chức năng liên quan đến mua bán, lịch sử giao dịch, khiếu nại, hoàn tiền.

**A-04 Seller (Người bán)**
Là người dùng đã đăng ký và được duyệt trở thành người bán trên hệ thống.
	- Có thể quản lý sản phẩm, danh mục, biến thể, hình ảnh, đơn hàng, ví điện tử, nhận thông báo, xử lý khiếu nại, xem thống kê doanh thu.
	- Có quyền truy cập các chức năng quản lý kho hàng, cập nhật trạng thái sản phẩm, phản hồi khách hàng.

**A-05 Admin (Quản trị viên)**
Là quản trị viên hệ thống, có toàn quyền quản lý, kiểm duyệt, giám sát, phân tích và xử lý các nghiệp vụ trên hệ thống.
	- Có thể quản lý user, seller, sản phẩm, đơn hàng, ví, trạng thái hệ thống, audit, duyệt seller, xử lý khiếu nại, xuất báo cáo thống kê.
	- Có quyền truy cập tất cả các phân hệ, thực hiện các thao tác kiểm duyệt, giám sát, phân tích dữ liệu, cảnh báo bảo mật.


#### Mô tả chi tiết các tác nhân

**A-01 Người dùng (User)**
Là bất kỳ ai sử dụng hệ thống, bao gồm cả Guest, Người mua (Buyer), và Người bán (Seller). Người dùng là đối tượng trung tâm của hệ thống, có thể thực hiện các thao tác sau:
	- Duyệt web, tìm kiếm sản phẩm, xem thông tin, nhận thông báo hệ thống.
	- Tùy theo vai trò (Guest, Buyer, Seller) sẽ có quyền hạn và chức năng khác nhau.
	- Ví dụ: Một người dùng có thể bắt đầu là Guest, sau đó đăng ký thành Buyer, hoặc đăng ký trở thành Seller.

**A-02 Guest (Khách vãng lai)**
Là người dùng chưa có tài khoản hoặc chưa đăng nhập vào hệ thống. Guest có các đặc điểm sau:
	- Chỉ có quyền truy cập các thông tin công khai: xem sản phẩm, tìm kiếm, đọc mô tả, xem đánh giá sản phẩm/seller.
	- Không thể thực hiện các thao tác liên quan đến giao dịch, quản lý cá nhân, ví, đơn hàng, hoặc gửi khiếu nại.
	- Có thể đăng ký tài khoản để trở thành Buyer hoặc Seller.
	- Ví dụ: Người truy cập website lần đầu, chỉ xem thông tin mà không đăng nhập.

**A-03 Buyer (Người mua)**
Là người dùng đã đăng ký tài khoản và đăng nhập với vai trò người mua. Buyer có các quyền và chức năng sau:
	- Thực hiện giao dịch mua hàng: đặt đơn, thanh toán, nhận sản phẩm số.
	- Quản lý đơn hàng: xem lịch sử, trạng thái, upload bằng chứng, gửi khiếu nại, yêu cầu hoàn tiền.
	- Quản lý ví điện tử: nạp tiền, rút tiền, kiểm tra số dư, xem lịch sử giao dịch.
	- Quản lý thông tin cá nhân: cập nhật hồ sơ, địa chỉ, avatar, bảo mật 2FA, OTP.
	- Đánh giá sản phẩm, phản hồi chất lượng dịch vụ/seller.
	- Nhận thông báo realtime về trạng thái đơn hàng, giao dịch, khuyến mãi.
	- Ví dụ: Người mua đăng nhập, đặt hàng, thanh toán qua ví, nhận key game qua email.

**A-04 Seller (Người bán)**
Là người dùng đã đăng ký và được duyệt trở thành người bán. Seller có các quyền và chức năng sau:
	- Quản lý sản phẩm: tạo mới, cập nhật, xoá, quản lý biến thể, hình ảnh, trạng thái sản phẩm.
	- Quản lý đơn hàng: xác nhận giao dịch, upload bằng chứng, xử lý khiếu nại, cập nhật trạng thái đơn hàng.
	- Quản lý ví điện tử: nhận tiền bán hàng, rút tiền, xem thống kê doanh thu, kiểm tra giao dịch nghi ngờ.
	- Quản lý thông tin cá nhân, nhận thông báo về đơn hàng, sản phẩm, khiếu nại.
	- Xem báo cáo thống kê: doanh thu, sản phẩm bán chạy, phản hồi khách hàng.
	- Ví dụ: Người bán đăng nhập, thêm sản phẩm mới, xác nhận đơn hàng, rút tiền về ngân hàng.

**A-05 Admin (Quản trị viên)**
Là quản trị viên hệ thống, có toàn quyền quản lý, kiểm duyệt, giám sát, phân tích và xử lý các nghiệp vụ. Admin có các quyền và chức năng sau:
	- Quản lý user: duyệt seller, khoá/mở tài khoản, phân quyền, kiểm tra trạng thái.
	- Quản lý sản phẩm: kiểm duyệt, phân loại, giám sát chất lượng, xử lý vi phạm.
	- Quản lý đơn hàng: giám sát giao dịch, xử lý khiếu nại, kiểm tra hoàn tiền.
	- Quản lý ví: kiểm tra giao dịch nghi ngờ, duyệt/từ chối rút tiền, thống kê tài chính.
	- Quản lý hệ thống: audit, cảnh báo bảo mật, xuất báo cáo thống kê, phân tích hiệu suất.
	- Nhận thông báo về các sự kiện quan trọng: giao dịch lớn, khiếu nại, nghi ngờ gian lận.
	- Ví dụ: Admin đăng nhập dashboard, duyệt seller mới, xử lý khiếu nại, xuất báo cáo doanh thu.

Các mô tả chi tiết này giúp xác định rõ vai trò, quyền hạn, chức năng và luồng nghiệp vụ của từng tác nhân, làm cơ sở cho việc xây dựng use-case, phân quyền và thiết kế hệ thống.
### 2.2.3 Định nghĩa các thực thể và tổ hợp thông tin được đề cập trong hệ thống

Các thực thể (Entity) là các đối tượng dữ liệu cốt lõi, đại diện cho các thành phần nghiệp vụ, lưu trữ và trao đổi thông tin giữa các phân hệ. Tổ hợp thông tin là các cấu trúc dữ liệu tổng hợp, phục vụ cho các luồng nghiệp vụ, API, event hoặc báo cáo thống kê.

#### Danh sách thực thể chính
| Ký hiệu | Tên thực thể      | Mô tả chức năng, thuộc tính chính |
|--------|-------------------|-----------------------------------|
| E-01   | User              | Người dùng hệ thống: id, email, tên, vai trò, trạng thái, địa chỉ, KYC, preference, avatar |
| E-02   | Product           | Sản phẩm số: id, tên, mô tả, giá, tồn kho, danh mục, biến thể, trạng thái, hình ảnh |
| E-03   | Category          | Danh mục sản phẩm: id, tên, mô tả, phân loại cha/con |
| E-04   | Order             | Đơn hàng: id, mã đơn, buyer, seller, sản phẩm, số lượng, giá, trạng thái, thời gian, bằng chứng |
| E-05   | Wallet            | Ví điện tử: id, user, số dư, trạng thái, lịch sử giao dịch |
| E-06   | Transaction       | Giao dịch ví: id, loại giao dịch, số tiền, trạng thái, thời gian, liên kết đơn hàng |
| E-07   | Notification      | Thông báo: id, user, nội dung, loại, trạng thái, thời gian gửi |
| E-08   | Complaint         | Khiếu nại: id, user, order, nội dung, trạng thái, thời gian xử lý |
| E-09   | RefundRequest     | Yêu cầu hoàn tiền: id, order, user, số tiền, trạng thái, thời gian xử lý |
| E-10   | BankAccount       | Tài khoản ngân hàng liên kết: id, user, số tài khoản, tên ngân hàng, trạng thái xác thực |
| E-11   | AuditLog          | Nhật ký hệ thống: id, user, hành động, thời gian, trạng thái |

#### Một số tổ hợp thông tin tiêu biểu
| Ký hiệu | Tên tổ hợp thông tin | Mô tả cấu trúc, mục đích sử dụng |
|---------|---------------------|----------------------------------|
| DTO     | Data Transfer Object | Đối tượng truyền dữ liệu qua API, gồm các trường cần thiết cho request/response |
| Event   | Kafka Event          | Thông tin sự kiện bất đồng bộ: tên event, payload, trạng thái, thời gian |
| Statistic | Thống kê tổng hợp   | Tổ hợp dữ liệu cho dashboard, báo cáo: doanh thu, số lượng đơn, top sản phẩm |
| Filter  | Bộ lọc dữ liệu       | Tổ hợp thông tin dùng cho tìm kiếm, lọc sản phẩm, đơn hàng, giao dịch |

#### Ví dụ thực tế về entity và tổ hợp thông tin
- **User**: Lưu thông tin người dùng, phục vụ xác thực, phân quyền, quản lý hồ sơ, ví, đơn hàng.
- **Product**: Lưu thông tin sản phẩm số, phục vụ bán hàng, quản lý kho, hiển thị cho buyer/seller.
- **Order**: Lưu thông tin giao dịch mua bán, trạng thái đơn hàng, bằng chứng, khiếu nại, hoàn tiền.
- **Wallet/Transaction**: Quản lý số dư, lịch sử giao dịch, nạp/rút tiền, thanh toán đơn hàng.
- **Notification**: Gửi thông báo realtime, cảnh báo, xác thực, cập nhật trạng thái cho user/seller/admin.
- **DTO/Event**: Truyền dữ liệu giữa các service, API, Kafka topic, đảm bảo xử lý bất đồng bộ và realtime.

Các thực thể và tổ hợp thông tin này là nền tảng cho việc thiết kế database, API, event, báo cáo và các luồng nghiệp vụ trong toàn hệ thống.

## 2.3 Danh sách các Use-Case của hệ thống


### 2.3.1 Phân hệ Người dùng (End-User / Buyer)
UC01-010 / Đăng ký tài khoản
UC01-020 / Đăng nhập hệ thống
UC01-030 / Quản lý mật khẩu (quên/reset/đổi)
UC01-040 / Đăng xuất khỏi hệ thống
UC01-050 / Lấy lại access token từ refresh token
UC01-060 / Quản lý bảo mật (Bật/tắt xác thực hai lớp 2FA)
UC01-070 / Xác thực OTP đăng nhập (verifyTwoFAuth)
UC01-080 / Gửi yêu cầu xác thực KYC
UC01-090 / Đăng ký trở thành người bán
UC01-100 / Lấy danh sách đánh giá người bán
UC01-110 / Đánh giá người bán
UC01-120 / Lấy hồ sơ đăng ký người bán
UC01-130 / Lấy thông tin người dùng theo ID
UC01-140 / Cập nhật thông tin người dùng
UC01-150 / Cập nhật avatar người dùng
UC01-160 / Lấy thông tin cài đặt preference
UC01-170 / Cập nhật cài đặt preference
UC01-180 / Tạo địa chỉ thanh toán (Billing Address)
UC01-190 / Cập nhật địa chỉ thanh toán
UC01-200 / Lấy địa chỉ thanh toán
UC01-210 / Lấy thông tin người dùng theo tên hiển thị

### 2.3.2 Phân hệ Quản trị hệ thống (Admin)
UC02-010 / Duyệt tài khoản người dùng
UC02-020 / Từ chối tài khoản người dùng
UC02-030 / Khoá tài khoản người dùng
UC02-040 / Xoá tài khoản người dùng
UC02-050 / Gán vai trò cho người dùng
UC02-060 / Xem danh sách user, lọc theo trạng thái
UC02-070 / Xem chi tiết user
UC02-080 / Đổi trạng thái seller cho user

### 2.3.3 Phân hệ Quản trị danh mục sản phẩm (Admin - Product)
UC03-010 / Tạo mới danh mục sản phẩm
UC03-020 / Cập nhật danh mục sản phẩm
UC03-030 / Xoá danh mục sản phẩm

### 2.3.4 Phân hệ Quản lý sản phẩm
UC04-010 / Tạo mới sản phẩm
UC04-020 / Cập nhật sản phẩm
UC04-030 / Xoá sản phẩm
UC04-040 / Xem danh sách sản phẩm
UC04-050 / Xem chi tiết sản phẩm
UC04-060 / Quản lý hình ảnh sản phẩm
UC04-070 / Quản lý biến thể sản phẩm
UC04-080 / Quản lý tồn kho

### 2.3.5 Phân hệ Đơn hàng & Hoàn tiền (Transaction)
UC05-010 / Tạo đơn hàng
UC05-020 / Xem đơn hàng (chi tiết, lịch sử)
UC05-030 / Huỷ đơn hàng
UC05-040 / Theo dõi trạng thái đơn hàng
UC05-050 / Xử lý đơn hàng (Seller xác nhận, fulfilment)
UC05-060 / Upload bằng chứng giao hàng
UC05-070 / Quản lý tranh chấp & hoàn tiền

### 2.3.6 Phân hệ Ví & Thanh toán (Wallet)
UC06-010 / Tạo ví điện tử (tự động khi user đăng ký)
UC06-020 / Xem số dư, lịch sử giao dịch
UC06-030 / Nạp tiền / Thanh toán bằng ví
UC06-040 / Thanh toán qua cổng VNPAY
UC06-050 / Theo dõi trạng thái thanh toán
UC06-060 / Rút tiền về tài khoản ngân hàng
UC06-070 / Quản lý tài khoản ngân hàng liên kết

### 2.3.7 Phân hệ Thông báo (Notification)
UC07-010 / Nhận email xác nhận đăng ký
UC07-020 / Nhận email reset mật khẩu
UC07-030 / Nhận OTP 2FA
UC07-040 / Nhận cảnh báo bảo mật (login từ thiết bị mới)
UC07-050 / Nhận URL thanh toán real-time qua WebSocket
UC07-060 / Nhận thông báo đơn hàng/thanh toán real-time

---

### Yêu cầu tổng quát của hệ thống Digital P2P

1. Đáp ứng đầy đủ các nghiệp vụ mua bán số, quản lý người dùng, sản phẩm, đơn hàng, ví điện tử, thanh toán, thông báo realtime, KYC, đánh giá seller, quản trị hệ thống.
2. Hỗ trợ các luồng nghiệp vụ chi tiết: đăng ký, đăng nhập, xác thực email/OTP/2FA, quản lý mật khẩu, hồ sơ cá nhân, preference, địa chỉ thanh toán, seller application, đánh giá seller, truy vấn user, cập nhật thông tin, quản lý trạng thái, audit log, lịch sử đăng nhập/mật khẩu, quản lý thiết bị.
3. Quản lý sản phẩm số: tạo, cập nhật, xoá, biến thể, hình ảnh, danh mục, tồn kho, trạng thái, tìm kiếm, lọc, phân loại, kiểm duyệt.
4. Quản lý đơn hàng: tạo, xem, huỷ, theo dõi trạng thái, upload bằng chứng, xử lý khiếu nại, hoàn tiền, lịch sử giao dịch, event Kafka.
5. Quản lý ví điện tử: tạo ví, nạp/rút tiền, thanh toán, liên kết ngân hàng, kiểm tra giao dịch nghi ngờ, thống kê, callback, event Kafka.
6. Quản lý thông báo: email xác thực, OTP, cảnh báo bảo mật, thông báo realtime qua WebSocket, lưu trữ, đánh dấu đã đọc, event Kafka, xử lý lỗi gửi thông báo.
7. Quản trị hệ thống: duyệt/khoá/xoá user, phân quyền, kiểm duyệt seller/sản phẩm, audit, báo cáo, thống kê, giám sát giao dịch, cảnh báo bảo mật, xử lý lỗi.
8. Đảm bảo bảo mật, hiệu năng, khả năng mở rộng, tích hợp linh hoạt, xử lý bất đồng bộ qua Kafka, phân quyền vai trò, lưu log, kiểm tra trạng thái, event-driven.
9. Hỗ trợ dashboard, báo cáo, thống kê, lọc, phân trang, truy vấn theo tiêu chí, phát hiện điểm nghẽn, cảnh báo bất thường, tối ưu vận hành.
10. Đáp ứng các yêu cầu nghiệp vụ, pháp lý, bảo mật, kiểm thử, vận hành, bảo trì, mở rộng hệ thống Digital P2P.

Các yêu cầu này được đặc tả chi tiết qua các Use-Case, thực thể, tổ hợp thông tin, luồng sự kiện, event, API, màn hình, trạng thái, phân hệ, actor, DTO, event Kafka, audit log, notification error, v.v. trong tài liệu.

## 4. Web Server và mô hình triển khai

### 4.1 Web Server sử dụng
- Hệ thống sử dụng các web server tích hợp sẵn trong Spring Boot (Tomcat embedded) cho các dịch vụ backend.
- Các dịch vụ có thể được đóng gói thành container Docker và expose port qua Docker Compose.
- Hỗ trợ reverse proxy, load balancing, bảo mật SSL/TLS thông qua các giải pháp như Nginx, Cloudflare Tunnel.

### 4.2 Mô hình triển khai thực tế
- Các dịch vụ được deploy trên VPS (máy chủ riêng hoặc cloud), sử dụng Docker Compose để quản lý các container (backend, database, cache, kafka, kafka-ui, redis, mongodb, mysql).
- Sử dụng Cloudflare Tunnel để bảo vệ, expose dịch vụ ra internet an toàn, hỗ trợ SSL/TLS, chống DDoS, tăng bảo mật truy cập.
- Docker Compose quản lý toàn bộ stack: web server, database, cache, kafka, monitoring, giúp dễ dàng mở rộng, bảo trì, rollback.
- Các dịch vụ backend giao tiếp qua mạng nội bộ (bridge network), chỉ expose các port cần thiết ra ngoài (ví dụ: 8080 cho web, 3306 cho MySQL, 6379 cho Redis, 9092 cho Kafka, 27017 cho MongoDB).

### 4.3 Kiến trúc mạng và bảo mật
- Sử dụng bridge network trong Docker để cô lập các dịch vụ, tăng bảo mật nội bộ.
- Cloudflare Tunnel làm lớp bảo vệ, kiểm soát truy cập, hỗ trợ SSL/TLS, chống tấn công mạng.
- Có thể tích hợp thêm Nginx hoặc các giải pháp proxy khác để routing, load balancing, kiểm soát traffic.

### 4.4 Lý do lựa chọn




### Mục tiêu bảo mật
- Đảm bảo an toàn dữ liệu người dùng, giao dịch, sản phẩm và thông tin hệ thống.
- Ngăn chặn truy cập trái phép, bảo vệ khỏi các cuộc tấn công mạng (DDoS, XSS, CSRF, SQL Injection, Brute Force...).
- Đảm bảo tính toàn vẹn, bảo mật và khả năng phục hồi dữ liệu.

### Các chính sách áp dụng
- **Xác thực & phân quyền:** Sử dụng JWT cho xác thực API, phân quyền theo vai trò (RBAC), kiểm soát truy cập từng chức năng/phân hệ.
- **Bảo mật truyền thông:** Tất cả kết nối ra/vào hệ thống đều sử dụng SSL/TLS (Cloudflare Tunnel, Nginx proxy, HTTPS).
- **Bảo vệ dữ liệu:** Mã hóa dữ liệu nhạy cảm (mật khẩu, token, thông tin ngân hàng), backup định kỳ, kiểm soát truy cập database.
- **Giám sát & cảnh báo:** Tích hợp logging tập trung, giám sát truy cập, phát hiện hành vi bất thường, cảnh báo realtime cho admin.
- **Chống tấn công tự động:** Sử dụng Cloudflare Tunnel, rate limit, captcha, kiểm tra IP, block bot, kiểm soát traffic.
- **Bảo mật ứng dụng:** Kiểm tra lỗ hổng bảo mật định kỳ (OWASP Top 10), kiểm thử tự động, audit log, kiểm tra trạng thái hệ thống.
- **Quản lý phiên & token:** Hạn chế thời gian sống của token, tự động logout khi phát hiện bất thường, bảo vệ refresh token.
- **Bảo mật event Kafka:** Kiểm soát quyền publish/subscribe, mã hóa payload, kiểm tra trạng thái event, log event bất thường.
- **Bảo mật file upload:** Kiểm tra định dạng, kích thước, virus/malware, lưu trữ riêng biệt, kiểm soát truy cập file.
- **Chính sách backup & phục hồi:** Backup dữ liệu định kỳ, lưu trữ nhiều bản, kiểm tra khả năng phục hồi khi có sự cố.

### Quy trình vận hành bảo mật
- Định kỳ kiểm tra, cập nhật các bản vá bảo mật cho hệ điều hành, phần mềm, thư viện.
- Kiểm thử bảo mật tự động trước khi release, kiểm tra log, audit, cảnh báo bất thường.
- Đào tạo nhân sự về bảo mật, quy trình xử lý sự cố, kiểm soát truy cập hệ thống.

### Cam kết bảo mật
- Hệ thống cam kết tuân thủ các quy định pháp luật về bảo vệ dữ liệu cá nhân, bảo mật thông tin giao dịch.
- Đảm bảo khả năng mở rộng, phục hồi, kiểm soát truy cập, bảo vệ toàn diện cho người dùng, đối tác và admin.

